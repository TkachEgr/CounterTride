<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CounterTride - Торговая площадка скинов CS2</title>
    <link rel="icon" href="https://images.steamusercontent.com/ugc/1679240682720191552/97A8F4B2595AAE37C53FA0420915522663FC5815/?imw=512&amp;imh=507&amp;ima=fit&amp;impolicy=Letterbox&amp;imcolor=%23000000&amp;letterbox=true" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e53935; /* Красный акцент */
            --primary-dark: #b71c1c; /* Темно-красный */
            --primary-light: #ff5252; /* Светло-красный */
            --dark: #121212;
            --darker: #0a0a0a;
            --dark-light: #1e1e1e;
            --light: #f5f5f5;
            --gray: #757575;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--darker);
            color: var(--light);
            line-height: 1.6;
            padding-top: 80px;
            background-image: radial-gradient(circle at 10% 20%, rgba(229, 57, 53, 0.1) 0%, rgba(18, 18, 18, 0) 30%);
        }

        /* Шапка */
        header {
            background: linear-gradient(90deg, var(--darker) 0%, #1a0000 100%);
            padding: 0.8rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo h1 {
            color: var(--primary-light);
            font-size: 2.2rem;
            text-shadow: 0 0 10px rgba(255, 82, 82, 0.3);
            letter-spacing: 1px;
            font-weight: 800;
        }

        .logo span {
            color: white;
            font-weight: 300;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav li {
            margin-left: 1.5rem;
        }

        nav a {
            color: var(--light);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1.1rem;
            padding: 0.5rem 0.8rem;
            border-radius: 5px;
            position: relative;
        }

        nav a:hover {
            color: var(--primary-light);
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-light);
            transition: width 0.3s;
        }

        nav a:hover::after {
            width: 100%;
        }

        nav a.active {
            color: var(--primary-light);
        }

        nav a.active::after {
            width: 100%;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 10px 24px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 4px 8px rgba(229, 57, 53, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20px;
            height: 200%;
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(25deg);
            transition: all 0.5s;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(229, 57, 53, 0.4);
        }

        .btn:hover::after {
            left: 120%;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary-light);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-small {
            padding: 6px 16px;
            font-size: 0.9rem;
        }

        .cart-icon {
            position: relative;
            font-size: 1.4rem;
            cursor: pointer;
            color: var(--light);
            transition: color 0.3s;
        }

        .cart-icon:hover {
            color: var(--primary-light);
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Основной контент */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: var(--primary-light);
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            border-radius: 2px;
        }

        .hero {
            text-align: center;
            padding: 4rem 2rem;
            margin-bottom: 4rem;
            border-radius: 15px;
            background: linear-gradient(rgba(26, 0, 0, 0.7), rgba(26, 0, 0, 0.7)), url('https://vkplay.ru/hotbox/content_files/UgcStories/2024/07/05/1d0d7591e3eb4de9843a5ca3bfc4fbf6.png');
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 2.5rem;
            color: #e0e0e0;
        }

        /* Каталог скинов */
        .skins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .skin-card {
            background: var(--dark-light);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #333;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .skin-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(229, 57, 53, 0.3);
        }

        .skin-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
        }

        .skin-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            background: linear-gradient(45deg, #1a0000, #2a0a0a);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .skin-image img {
            max-width: 100%;
            max-height: 180px;
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.7));
        }

        .skin-info {
            padding: 1.5rem;
            border-top: 1px solid #333;
        }

        .skin-name {
            color: white;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            min-height: 64px;
        }

        .skin-price {
            color: var(--primary-light);
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .skin-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .skin-rarity {
            background: var(--primary-dark);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .stattrak {
            color: var(--primary-light);
            font-weight: bold;
        }

        .skin-actions {
            display: flex;
            gap: 10px;
        }

        /* Продать скин */
        .sell-section {
            background: linear-gradient(rgba(26, 0, 0, 0.8), rgba(26, 0, 0, 0.8)), url('https://steamuserimages-a.akamaihd.net/ugc/2054260171628995476/04E9FED0D15ECC0A4E3D49803E971442EAFBED90/?imw=512&amp;imh=384&amp;ima=fit&amp;impolicy=Letterbox&amp;imcolor=%23000000&amp;letterbox=true');
            background-size: cover;
            background-position: center;
            padding: 4rem 2rem;
            border-radius: 15px;
            margin: 5rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .sell-form {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(30, 30, 30, 0.9);
            padding: 2.5rem;
            border-radius: 15px;
            border: 1px solid var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--light);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 5px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 2px rgba(229, 57, 53, 0.3);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .instructions {
            background: rgba(26, 0, 0, 0.7);
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
            border-left: 4px solid var(--primary);
        }

        .instructions h3 {
            color: var(--primary-light);
            margin-bottom: 1rem;
        }

        .instructions ol {
            padding-left: 1.5rem;
        }

        .instructions li {
            margin-bottom: 0.8rem;
            line-height: 1.6;
        }

        .filter-section {
            background: var(--dark-light);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-btn {
            background: #333;
            color: var(--light);
            border: none;
            padding: 8px 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Подвал */
        footer {
            background: #0a0000;
            padding: 3rem 5%;
            text-align: center;
            border-top: 1px solid var(--primary);
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            text-align: left;
        }

        .footer-logo {
            font-size: 2rem;
            color: var(--primary-light);
            margin-bottom: 1rem;
            font-weight: 800;
        }

        .footer-column h3 {
            color: var(--primary-light);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background: var(--primary);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column ul li a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: var(--primary-light);
        }

        .copyright {
            max-width: 1200px;
            margin: 2rem auto 0;
            padding-top: 1.5rem;
            border-top: 1px solid #333;
            font-size: 0.9rem;
            color: var(--gray);
        }
        /* Корзина */
        .cart-modal {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100%;
            background: var(--dark-light);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
            transition: right 0.4s ease;
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }

        .cart-modal.active {
            right: 0;
        }

        .cart-header {
            padding: 1.5rem;
            background: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h3 {
            font-size: 1.5rem;
            color: white;
        }

        .close-cart {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 1rem 0;
            border-bottom: 1px solid #3a3a3a;
        }

        .cart-item-image {
            width: 80px;
            height: 60px;
            background: #3a3a3a;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-item-image img {
            max-width: 70%;
            max-height: 50px;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-size: 1rem;
            margin-bottom: 5px;
            color: white;
        }

        .cart-item-price {
            color: var(--secondary);
            font-weight: bold;
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0 5px;
        }

        .cart-footer {
            padding: 1.5rem;
            background: #1a1a1a;
            border-top: 1px solid #3a3a3a;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
        }

        .cart-total span:last-child {
            color: var(--secondary);
            font-weight: bold;
        }

        /* Формы */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .auth-container {
            background: var(--dark-light);
            border-radius: 10px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .auth-header {
            padding: 1.5rem;
            background: var(--primary);
            text-align: center;
        }

        .auth-header h2 {
            color: white;
        }

        .auth-tabs {
            display: flex;
            background: #1a1a1a;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .auth-tab.active {
            background: var(--dark-light);
            color: var(--accent);
        }

        .auth-body {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: #3a3a3a;
            border: 1px solid #3a3a3a;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
        }

        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
        }

        /* Адаптивность */
        @media (max-width: 992px) {
            .skins-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .hero h1 {
                font-size: 3rem;
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 1rem;
                gap: 1rem;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }

            nav li {
                margin: 0;
            }

            .section-title {
                font-size: 2rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 576px) {
            .skins-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 1rem;
            }

            .hero {
                padding: 2rem 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }
        }
        @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(20px); }
    }
    </style>
</head>
<body>
<!-- Шапка сайта -->
<header>
    <a href="#" class="logo">
        <h1>COUNTER<span>TRIDE</span></h1>
    </a>
    <nav>
        <ul>
            <li><a href="#" class="active">Главная</a></li>
            <li><a href="catalog.html">Каталог</a></li>
            <li><a href="prodaza.html">Продать скин</a></li>
            <li><a href="https://t.me/PampersGangster">Поддержка</a></li>
        </ul>
    </nav>
    <div class="user-actions">
        <div class="cart-icon" id="cartIcon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCount">0</span>
        </div>
    </div>
</header>

<!-- Основной контент -->
<main class="container">
    <!-- Герой-секция -->
    <section class="hero">
        <h1>ТОРГОВАЯ ПЛОЩАДКА СКИНОВ CS2</h1>
        <p>Покупайте и продавайте скины для Counter-Strike 2 по лучшим ценам с гарантией безопасности</p>
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 2rem;">
            <a href="catalog.html" class="btn">Купить скины</a>
            <a href="prodaza.html" class="btn">Продать скины</a>
        </div>
    </section>

    <!-- Каталог скинов -->
    <section id="catalog" style="margin: 5rem 0;">
        <h2 class="section-title">Популярные скины</h2>

        <div class="skins-grid" id="skinsContainer">
            <!-- Скины будут загружены через JavaScript -->
        </div>

        <div style="text-align: center; margin-top: 3rem;">
            <a href="catalog.html" class="btn">Перейти в полный каталог</a>
        </div>
    </section>

    <!-- Как это работает -->
    <section id="how-it-works" style="background: #1a0000; padding: 4rem 2rem; border-radius: 15px; margin: 5rem 0; border: 1px solid var(--primary);">
        <h2 class="section-title">Как работает покупка</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; max-width: 1200px; margin: 0 auto;">
            <div style="text-align: center; padding: 2rem; background: #252525; border-radius: 10px; border-bottom: 3px solid var(--primary);">
                <div style="background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; font-weight: bold;">1</div>
                <h3 style="color: var(--primary-light); margin-bottom: 1rem; font-size: 1.5rem;">Выбери скин</h3>
                <p>Найди нужный скин в нашем каталоге</p>
            </div>
            <div style="text-align: center; padding: 2rem; background: #252525; border-radius: 10px; border-bottom: 3px solid var(--primary);">
                <div style="background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; font-weight: bold;">2</div>
                <h3 style="color: var(--primary-light); margin-bottom: 1rem; font-size: 1.5rem;">Оформи заказ</h3>
                <p>Добавь скин в корзину и заверши покупку</p>
            </div>
            <div style="text-align: center; padding: 2rem; background: #252525; border-radius: 10px; border-bottom: 3px solid var(--primary);">
                <div style="background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; font-weight: bold;">3</div>
                <h3 style="color: var(--primary-light); margin-bottom: 1rem; font-size: 1.5rem;">Прими трейд</h3>
                <p>Прими наш трейд-офер в Steam</p>
            </div>
        </div>
    </section>
</main>

<!-- Корзина -->
<div class="cart-modal" id="cartModal">
    <div class="cart-header">
        <h3>Ваша корзина</h3>
        <button class="close-cart" id="closeCart"><i class="fas fa-times"></i></button>
    </div>
    <div class="cart-items" id="cartItems">
        <!-- Товары в корзине -->
    </div>
    <div class="cart-footer">
        <div class="cart-total">
            <span>Итого:</span>
            <span id="cartTotal">$0.00</span>
        </div>
        <button class="btn btn-block btn-secondary" id="checkoutBtn">Оформить заказ</button>
    </div>
</div>

<!-- Модальное окно авторизации -->
<div class="auth-modal" id="authModal">
    <div class="auth-container">
        <div class="auth-header">
            <h2>Вход в аккаунт</h2>
        </div>
        <div class="auth-tabs">
            <div class="auth-tab active" data-tab="login">Вход</div>
            <div class="auth-tab" data-tab="register">Регистрация</div>
        </div>
        <div class="auth-body">
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="password">Пароль</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-block">Войти</button>
            </form>

            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="regName">Имя</label>
                    <input type="text" id="regName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Пароль</label>
                    <input type="password" id="regPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="regConfirm">Подтвердите пароль</label>
                    <input type="password" id="regConfirm" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-block">Зарегистрироваться</button>
            </form>
        </div>
    </div>
</div>

<!-- Подвал сайта -->
<footer>
    <div class="footer-content">
        <div class="footer-column">
            <div class="footer-logo">COUNTERTRIDE</div>
            <p>Лучшая площадка для безопасной и выгодной торговли скинами из Counter-Strike 2. Гарантия сделок, лучшие цены, моментальные выплаты.</p>
        </div>

        <div class="footer-column">
            <h3>Навигация</h3>
            <ul>
                <li><a href="#">Главная</a></li>
                <li><a href="catalog.html">Каталог скинов</a></li>
                <li><a href="prodaza.html">Продать скин</a></li>
            </ul>
        </div>

        <div class="footer-column">
            <h3>Контакты</h3>
            <ul>
                <li><a href="https://steamcommunity.com/groups/EnclaveSteel" >Steam группа</a></li>
                <li><a href="https://web.telegram.org/a/#-1001378102312">Telegram канал</a></li>
                <li><a href="https://e.mail.ru/compose/?to=egor.tkachenko.1999%40list.ru">Email</a></li>
            </ul>
        </div>
    </div>

    <div class="copyright">
        <p>© 2025 CounterTride. Данный сайт никак не связан с Valve Corporation, Steam или Counter-Strike 2.</p>
        <p style="margin-top: 0.5rem;">Торговые марки принадлежат их правообладателям. Все сделки осуществляются через официальную систему обмена Steam.</p>
    </div>

</footer>

<script>
    // Глобальные переменные
    let allSkins = [];
    let filteredSkins = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let userTradeLink = localStorage.getItem('tradeLink') || '';

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', async () => {
        initCart();
        loadSkins();
        setupEventListeners();
        updateCartUI();
    });

    // Инициализация корзины
    function initCart() {
        const cartModal = document.createElement('div');
        cartModal.className = 'cart-modal';
        cartModal.innerHTML = `
            <div class="cart-header">
                <h3>Ваша корзина</h3>
                <button class="close-cart"><i class="fas fa-times"></i></button>
            </div>
            <div class="cart-items" id="cartItems"></div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Итого:</span>
                    <span id="cartTotal">$0.00</span>
                </div>
                <button class="btn btn-block" id="checkoutBtn">Оформить заказ</button>
            </div>
        `;
        document.body.appendChild(cartModal);
    }

    // Загрузка скинов
    async function loadSkins() {
        try {
            const response = await fetch('skins.json');
            if (!response.ok) throw new Error('Ошибка загрузки данных');
            allSkins = await response.json();
            filteredSkins = allSkins.slice(0, 6); // Показываем первые 6 скинов
            renderSkins();
        } catch (error) {
            console.error('Ошибка:', error);
            document.getElementById('skinsContainer').innerHTML =
                '<div class="error-message">Не удалось загрузить данные о скинах</div>';
        }
    }

    // Настройка обработчиков событий
    function setupEventListeners() {
        // Корзина
        document.getElementById('cartIcon').addEventListener('click', () => {
            document.querySelector('.cart-modal').classList.add('active');
        });

        document.querySelector('.close-cart').addEventListener('click', () => {
            document.querySelector('.cart-modal').classList.remove('active');
        });

        document.getElementById('checkoutBtn').addEventListener('click', checkout);

    // Новый обработчик для формы продажи
    const sellForm = document.getElementById('sellForm');
    if (sellForm) {
        sellForm.addEventListener('submit', function(e) {
            e.preventDefault();
            handleSellFormSubmit(e);
        });
    }

        // Сохранение трейд ссылки из корзины
        document.addEventListener('click', (e) => {
            if (e.target.id === 'save-trade-link') {
                saveTradeLinkFromCart();
            }
        });
    }

    // Работа с корзиной
    function updateCartUI() {
        const cartCount = document.getElementById('cartCount');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');

        cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

        // Блок с трейд ссылкой
        cartItems.innerHTML = `
            <div class="cart-trade-link" style="padding: 1rem; background: rgba(26, 0, 0, 0.5); margin-bottom: 1rem; border-radius: 5px;">
                <label style="display: block; margin-bottom: 0.5rem; color: ${userTradeLink ? 'var(--success)' : 'var(--danger)'};">
                    <i class="fas ${userTradeLink ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                    ${userTradeLink ? 'Трейд ссылка указана' : 'Трейд ссылка не указана!'}
                </label>
                <input type="text" id="cart-trade-link-input" class="form-control"
                       value="${userTradeLink || ''}"
                       placeholder="https://steamcommunity.com/tradeoffer/new/?partner=..."
                       style="margin-bottom: 0.5rem;">
                <button class="btn btn-small" id="save-trade-link" style="width: 100%;">
                    <i class="fas fa-save"></i> Сохранить
                </button>
            </div>
        `;

        if (cart.length === 0) {
            cartItems.innerHTML += '<p style="text-align: center; color: var(--gray);">Ваша корзина пуста</p>';
            cartTotal.textContent = '$0.00';
            return;
        }

        let total = 0;
        cart.forEach(item => {
            const skin = allSkins.find(s => s.id === item.id);
            if (skin) {
                total += skin.price * item.quantity;
                cartItems.innerHTML += `
                    <div class="cart-item">
                        <div class="cart-item-image">
                            <img src="${skin.image || 'https://via.placeholder.com/100/1a1a2e/4fc3f7?text=' + skin.name.substring(0, 2)}" alt="${skin.name}">
                        </div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${skin.name}</div>
                            <div class="cart-item-price">$${skin.price.toFixed(2)} × ${item.quantity}</div>
                        </div>
                        <button class="cart-item-remove" data-id="${skin.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            }
        });

        cartTotal.textContent = `$${total.toFixed(2)}`;

        // Обработчики для кнопок удаления
        document.querySelectorAll('.cart-item-remove').forEach(btn => {
            btn.addEventListener('click', () => removeFromCart(parseInt(btn.dataset.id)));
        });
    }

    function addToCart(skinId) {
        const skin = allSkins.find(s => s.id === skinId);
        if (!skin) return;

        const existingItem = cart.find(item => item.id === skin.id);

        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({
                ...skin,
                quantity: 1
            });
        }

        saveCart();
        showNotification(`"${skin.name}" добавлен в корзину!`, 'error');
        updateCartUI();
    }

    function removeFromCart(skinId) {
        cart = cart.filter(item => item.id !== skinId);
        saveCart();
        updateCartUI();
    }

    function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    function checkout() {
        if (cart.length === 0) {
            showNotification('Ваша корзина пуста!', 'error');
            return;
        }

        if (!userTradeLink) {
            showNotification('Для оформления заказа укажите Steam трейд ссылку!', 'error');
            document.querySelector('.cart-modal').classList.add('active');
            return;
        }

        const total = cart.reduce((sum, item) => {
            const skin = allSkins.find(s => s.id === item.id);
            return sum + (skin ? skin.price * item.quantity : 0);
        }, 0);

        showNotification(`Заказ оформлен! Сумма: $${total.toFixed(2)}\nМы отправим вам трейд-офер в Steam.`, 'success');
        cart = [];
        saveCart();
        updateCartUI();
        document.querySelector('.cart-modal').classList.remove('active');
    }

    function handleSellFormSubmit(e) {
    const form = e.target;
    const steamLink = form.querySelector('#steam-link').value;
    const skinDetails = form.querySelector('#skin-details').value;
    const price = form.querySelector('#price').value;
    const email = form.querySelector('#email').value;

    // Валидация
    if (!steamLink || !skinDetails || !price || !email) {
        showNotification('Пожалуйста, заполните все поля формы!', 'error');
        return;
    }

    if (!steamLink.includes('steamcommunity.com/tradeoffer')) {
        showNotification('Пожалуйста, укажите корректную Steam трейд ссылку!', 'error');
        return;
    }

    if (isNaN(parseFloat(price)) || parseFloat(price) <= 0) {
        showNotification('Пожалуйста, укажите корректную цену!', 'error');
        return;
    }

    if (!email.includes('@') || !email.includes('.')) {
        showNotification('Пожалуйста, укажите корректный email!', 'error');
        return;
    }

    // Сохраняем трейд ссылку
    userTradeLink = steamLink;
    localStorage.setItem('tradeLink', userTradeLink);

    // Очищаем форму
    form.reset();

    // Показываем уведомление
    showNotification('Заявка отправлена. Скоро ваш скин появится в каталоге других пользователей', 'success');
    updateCartUI();
}

    function saveTradeLinkFromCart() {
        const input = document.getElementById('cart-trade-link-input');
        const link = input.value.trim();

        if (!link.includes('steamcommunity.com/tradeoffer')) {
            showNotification('Пожалуйста, укажите корректную Steam трейд ссылку!', 'error');
            return;
        }

        userTradeLink = link;
        localStorage.setItem('tradeLink', userTradeLink);
        showNotification('Трейд ссылка сохранена!', 'success');
        updateCartUI();
    }

    // Отображение скинов
    function renderSkins() {
        const container = document.getElementById('skinsContainer');
        container.innerHTML = '';

        if (filteredSkins.length === 0) {
            container.innerHTML = '<div class="no-results">Скины не найдены</div>';
            return;
        }

        filteredSkins.forEach(skin => {
            const skinCard = document.createElement('div');
            skinCard.className = 'skin-card';
            skinCard.innerHTML = `
                <div class="skin-badge">${skin.rarity || 'Rare'}</div>
                <div class="skin-image">
                    <img src="${skin.image || 'https://via.placeholder.com/300/1a1a2e/4fc3f7?text=' + skin.type.toUpperCase()}" alt="${skin.name}">
                </div>
                <div class="skin-info">
                    <h3 class="skin-name">${skin.name}</h3>
                    <div class="skin-price">$${skin.price.toFixed(2)}</div>
                    <div class="skin-meta">
                        <span>${getWeaponName(skin.type)}</span>
                        <span>Float: ${skin.float || '0.00'}</span>
                        ${skin.stattrak ? '<span class="stattrak">StatTrak™</span>' : ''}
                    </div>
                    <div class="skin-actions">
                        <button class="btn btn-small add-to-cart" data-id="${skin.id}">
                            <i class="fas fa-cart-plus"></i> В корзину
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(skinCard);
        });

        // Обработчики добавления в корзину
        document.querySelectorAll('.add-to-cart').forEach(btn => {
            btn.addEventListener('click', () => addToCart(parseInt(btn.dataset.id)));
        });
    }

    // Вспомогательные функции
    function getWeaponName(type) {
        const names = {
            "usp-s": "USP-S", "p2000": "P2000", "r8": "R8 Revolver", "cz75": "CZ75-Auto",
            "dual": "Dual Berettas", "p250": "P250", "five-seven": "Five-Seven", "deagle": "Desert Eagle",
            "nova": "Nova", "mp7": "MP7", "negev": "Negev", "mag7": "MAG-7", "bizon": "PP-Bizon",
            "ump": "UMP-45", "m249": "M249", "xm1014": "XM1014", "mp5": "MP5-SD", "p90": "P90",
            "mp9": "MP9", "scar20": "SCAR-20", "m4a4": "M4A4", "famas": "FAMAS", "m4a1": "M4A1-S",
            "ssg08": "SSG 08", "aug": "AUG", "awp": "AWP", "zeus": "Zeus x27", "knife": "Нож",
            "gloves": "Перчатки"
        };
        return names[type] || type;
    }

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.right = '20px';
        notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
        notification.style.color = 'white';
        notification.style.padding = '15px 25px';
        notification.style.borderRadius = '5px';
        notification.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        notification.style.zIndex = '10000';
        notification.style.animation = 'fadeIn 0.3s';
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'fadeOut 0.3s';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
</script>
</body>
</html>